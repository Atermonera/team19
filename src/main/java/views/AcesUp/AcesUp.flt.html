<link href="https://fonts.googleapis.com/css?family=Fascinate+Inline|Quicksand" rel="stylesheet">
<h1>Aces Up</h1>

<link href="/assets/css/AcesUp.css" rel="stylesheet">
<script type="text/javascript" src="/assets/webjars/jquery/2.1.3/jquery.js"></script>

<body>
	<div>
		<div class="movebutton">
			<BR>Move from column <input type="text" id="from_col"  /> to <input type="text" id="to_col"  /> <button id="moveButton">Move</button>
		</div>
		<table class="main">
			<tr class="columnTitles">
				<td></td>
				<td><b>Col #0</b></td>
				<td><b>Col #1</b></td>
				<td><b>Col #2</b></td>
				<td><b>Col #3</b></td>
			</tr>
			<tr class="board">
				<td id="c-1">
					<button id="dealButton">Deal</button>
					<table id="otherDecks">
						<tr><td class="extra" id="Deck">
								<img src="/assets/cardimages/red_back.png"/>
							</td></tr>
							<tr><td class="extra" id="Discard">
									<img src="/assets/cardimages/Joker.jpg"/>
								</td></tr>
					</table>
				</td>
				<td class="columnOfCards" id="c0">
					<table id="Remove1">
						<tr><td class="cardLocation l0"></td></tr>
						<tr><td class="cardLocation l1"></td></tr>
						<tr><td class="cardLocation l2"></td></tr>
						<tr><td class="cardLocation l3"></td></tr>
						<tr><td class="cardLocation l4"></td></tr>
						<tr><td class="cardLocation l5"></td></tr>
						<tr><td class="cardLocation l6"></td></tr>
						<tr><td class="cardLocation l7"></td></tr>
						<tr><td class="cardLocation l8"></td></tr>
						<tr><td class="cardLocation l9"></td></tr>
						<tr><td class="cardLocation l10"></td></tr>
						<tr><td class="cardLocation l11"></td></tr>
						<tr><td class="cardLocation l12"></td></tr>
						<tr><td class="cardLocation l13"></td></tr>
					</table>
				</td>
				<td class="columnOfCards" id="c1">
					<table id="Remove2">
						<tr><td class="cardLocation l0"></td></tr>
						<tr><td class="cardLocation l1"></td></tr>
						<tr><td class="cardLocation l2"></td></tr>
						<tr><td class="cardLocation l3"></td></tr>
						<tr><td class="cardLocation l4"></td></tr>
						<tr><td class="cardLocation l5"></td></tr>
						<tr><td class="cardLocation l6"></td></tr>
						<tr><td class="cardLocation l7"></td></tr>
						<tr><td class="cardLocation l8"></td></tr>
						<tr><td class="cardLocation l9"></td></tr>
						<tr><td class="cardLocation l10"></td></tr>
						<tr><td class="cardLocation l11"></td></tr>
						<tr><td class="cardLocation l12"></td></tr>
						<tr><td class="cardLocation l13"></td></tr>
					</table>
				</td>
				<td class="columnOfCards" id="c2">
					<table id="Remove3">
						<tr><td class="cardLocation l0"></td></tr>
						<tr><td class="cardLocation l1"></td></tr>
						<tr><td class="cardLocation l2"></td></tr>
						<tr><td class="cardLocation l3"></td></tr>
						<tr><td class="cardLocation l4"></td></tr>
						<tr><td class="cardLocation l5"></td></tr>
						<tr><td class="cardLocation l6"></td></tr>
						<tr><td class="cardLocation l7"></td></tr>
						<tr><td class="cardLocation l8"></td></tr>
						<tr><td class="cardLocation l9"></td></tr>
						<tr><td class="cardLocation l10"></td></tr>
						<tr><td class="cardLocation l11"></td></tr>
						<tr><td class="cardLocation l12"></td></tr>
						<tr><td class="cardLocation l13"></td></tr>
					</table>
				</td>
				<td class="columnOfCards" id="c3">
					<table id="Remove4">
						<tr><td class="cardLocation l0"></td></tr>
						<tr><td class="cardLocation l1"></td></tr>
						<tr><td class="cardLocation l2"></td></tr>
						<tr><td class="cardLocation l3"></td></tr>
						<tr><td class="cardLocation l4"></td></tr>
						<tr><td class="cardLocation l5"></td></tr>
						<tr><td class="cardLocation l6"></td></tr>
						<tr><td class="cardLocation l7"></td></tr>
						<tr><td class="cardLocation l8"></td></tr>
						<tr><td class="cardLocation l9"></td></tr>
						<tr><td class="cardLocation l10"></td></tr>
						<tr><td class="cardLocation l11"></td></tr>
						<tr><td class="cardLocation l12"></td></tr>
						<tr><td class="cardLocation l13"></td></tr>
					</table>
				</td>
			</tr>
		</table>
	</div>


	<script>

		var game;

var col1top = 0;
var col2top = 0; //these will initially start at 1 because 1 card starts there
var col3top = 0; //when OO is implemented, need to change these back to 0
var col4top = 0; //because "Deal" func. will run at initilization
function display(game) {
	console.log(game);

	$( '.columnOfCards .cardLocation' ).html("");

	$.each(game.cols[0].stack, function( key, val ) {
		$( '#c0 .l'+key ).data("card", val.value+val.suit).html('<img src="/assets/cardimages/'+val.value+val.suit+'.png" height=200px/>');
	});

	$.each(game.cols[1].stack, function( key, val ) {
		$( '#c1 .l'+key ).data("card", val.value+val.suit).html('<img src="/assets/cardimages/'+val.value+val.suit+'.png" height=200px/>');
	});

	$.each(game.cols[2].stack, function( key, val ) {
		$( '#c2 .l'+key ).data("card", val.value+val.suit).html('<img src="/assets/cardimages/'+val.value+val.suit+'.png" height=200px/>');
	});

	$.each(game.cols[3].stack, function( key, val ) {
		$( '#c3 .l'+key ).data("card", val.value+val.suit).html('<img src="/assets/cardimages/'+val.value+val.suit+'.png" height=200px/>');
	});

}

$.getJSON("http://localhost:8080/game", function( data ) {
	display(data);
	game = data;
});




$("#dealButton").click(function(){
	$.ajax({
		type: "POST",
		url: "/dealGame",
		data: JSON.stringify(game),
		success: function(data, status){
			console.log("Data: " + data + "\nStatus: " + status);
			game = data;
			display(data);
		},
		contentType:"application/json; charset=utf-8",
		dataType:"json",
	});
	col1top = col1top + 1;
	col2top = col2top + 1;
	col3top = col3top + 1;
	col4top = col4top + 1;
	if (game.deck.length<=4) {
		console.log("out!");
		$('td#Deck').html('<img src="/assets/cardimages/Joker.jpg"/>')
	}
	if(game.deck.length<=0)
		alert("The deck is out of cards.");
});


function removeCard(colNumber){
	console.log(/removeCard/);
	console.log("Column:", colNumber);
	$.ajax({
		type: "POST",
		url: "/removeCard/"+colNumber,
		data: JSON.stringify(game),
		success: function(data, status){
			console.log("Data: " + data + "\nStatus: " + status);
			game = data;
			if (game.removeCard == true){
				function addToDiscard(thisColTop, colNumber){
					var card = $('#c'+colNumber+' .l'+thisColTop).data("card");
					if (thisColTop >= 0) {
						var card = $('#c'+colNumber+' .l'+thisColTop).data("card");
						$('#Discard').html('<img src="/assets/cardimages/'+card+'.png"/>');
					}
				}
				switch (colNumber) {
					case 0:
						addToDiscard(col1top, colNumber);
						col1top = col1top - 1;
						break;
					case 1:
						addToDiscard(col2top, colNumber);
						col2top = col2top - 1;
						break;
					case 2:
						addToDiscard(col3top, colNumber);
						col3top = col3top - 1;
						break;
					case 3:
						addToDiscard(col4top, colNumber);
						col4top = col4top - 1;
						break;
				}
			}
			display(data);
		},
		contentType:"application/json; charset=utf-8",
		dataType:"json",
	});
}

console.log(game);


$("#Remove1").click(function(){
	console.log("attempting to remove from column 0");
	removeCard(0);
});

$("#Remove2").click(function(){
	console.log("attempting to remove from column 1");
	removeCard(1);
});

$("#Remove3").click(function(){
	console.log("attempting to remove from column 2");
	removeCard(2);
});

$("#Remove4").click(function(){
	console.log("attempting to remove from column 3");
	removeCard(3);
});


$("#moveButton").click(function(){
	var colFrom = $("#from_col").val();
	var colTo = $("#to_col").val();
	$.ajax({
		type: "POST",
		url: "/moveCard/"+colFrom+"/"+colTo,
		data: JSON.stringify(game),
		success: function(data, status){
			console.log("Data: " + data + "\nStatus: " + status);
			game = data;
			display(data);
		},
		contentType:"application/json; charset=utf-8",
		dataType:"json",
	});
});


	</script>



</body>
</html>
